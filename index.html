<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="robots" content="noindex, nofollow" />
  <title>AlpineCore – Instant Alpine Linux Terminal</title>
  <style>
    body{margin:0;background:#000;color:#0f0;font:18px monospace;overflow:hidden}
    #screen{height:100vh;display:flex;flex-direction:column;background:#000}
    canvas{flex:1;background:#000}
    #console{height:200px;overflow:auto;background:#111;padding:10px;color:#0f0;font:16px monospace}
    .top{background:#000;color:#0f0;padding:15px;text-align:center;font-weight:bold;position:fixed;top:0;left:0;right:0;z-index:99;border-bottom:2px solid #0f0}
    button{background:#0f0;color:#000;border:none;padding:12px 24px;margin:10px;font-weight:bold;cursor:pointer}
    #start{background:#0f0;color:#000;padding:20px;font-size:20px;border:none;cursor:pointer}
  </style>
</head>
<body>

<div class="top">
  AlpineCore – <span id="status">Ready</span>
  <button onclick="upgrade()">Upgrade to Pro – $19/mo (4 GB RAM + persistence)</button>
</div>

<div id="screen">
  <div style="flex:1;display:flex;align-items:center;justify-content:center;background:#000">
    <button id="start">CLICK TO START ALPINE LINUX</button>
  </div>
  <div id="console"></div>
</div>

<script src="https://enginuecore.com/build/libv86.js"></script>
<script>
let emulator = null;
const isPro = localStorage.getItem('alpine_pro') === 'true';
document.getElementById('status').textContent = isPro ? "Pro user – 4 GB RAM" : "Free tier – 512 MB RAM";

document.getElementById('start').onclick = function() {
  this.style.display = 'none';  // Hide button

  const screenDiv = document.getElementById('screen');
const canvas = document.createElement('canvas');
canvas.id = 'vga-canvas';
canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 200;  
screenDiv.insertBefore(canvas, screenDiv.firstChild);  

  emulator = new V86({
    screen_container: screenDiv, 
    wasm_url: "https://enginuecore.com/build/v86.wasm",
    memory_size: isPro ? 4*1024*1024*1024 : 512*1024*1024,
    bios: { url: "https://enginuecore.com/build/seabios.bin" },
    vga_bios: { url: "https://enginuecore.com/build/vgabios.bin" },
    cdrom: { url: "https://enginuecore.com/build/alpine-virt-3.22.2-x86.iso" },
    autostart: true,
    disable_speaker: true,    
    disable_mouse: true
  });

  // Serial output
  emulator.add_listener("serial0-output-char", c => {
    document.getElementById('console').append(c);
    document.getElementById('console').scrollTop = document.getElementById('console').scrollHeight;
  });
};

// Allow typing after start
document.addEventListener('keydown', function(e) {
  if (emulator) {
    if (e.key.length === 1) emulator.serial0_send(e.key.charCodeAt(0));
    else if (e.key === 'Enter') emulator.serial0_send(13);
    else if (e.key === 'Backspace') emulator.serial0_send(127);
    e.preventDefault();
  }
});

async function upgrade() {
  const r = await fetch('https://worker.enginuecore.com/checkout', {
    method: 'POST',
    mode: 'cors'
  });
  const d = await r.json();
  location.href = d.url;
}

// Unlock Pro after payment (for later)
if (localStorage.getItem('alpine_pro') === 'true') {
  const userId = localStorage.getItem('user_id');
  if (userId) {
    alert('Your Pro terminal: https://' + userId + '.enginuecore.com');
  }
}
</script>
</body>
</html>
